<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/Blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/Blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/Blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/Blog/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="googlea0cb77247135ae4c.html">

<link rel="stylesheet" href="/Blog/css/main.css">


<link rel="stylesheet" href="/Blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"cromarmot.github.io","root":"/Blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="知识依赖 基本的js语法 基本的nodejs用法 Promise用法  准备工作我想用nodejs直接跑rxjs，然而它并不支持es6的import，尝试了--experimental-modules依然有报错 方案1 在线编辑器https://rxjs-dev.firebaseapp.com/guide/observable 在上面代码点击右上角的Edit in StackBlitx 方案2 n">
<meta name="keywords" content="Angular2+,rxjs,observable">
<meta property="og:type" content="article">
<meta property="og:title" content="RxJS文档 阅读笔记">
<meta property="og:url" content="https://cromarmot.github.io/Blog/19-06-27-rxjs/index.html">
<meta property="og:site_name" content="Cro-Marmot&#39;s Blog">
<meta property="og:description" content="知识依赖 基本的js语法 基本的nodejs用法 Promise用法  准备工作我想用nodejs直接跑rxjs，然而它并不支持es6的import，尝试了--experimental-modules依然有报错 方案1 在线编辑器https://rxjs-dev.firebaseapp.com/guide/observable 在上面代码点击右上角的Edit in StackBlitx 方案2 n">
<meta property="og:locale" content="zh-TW">
<meta property="og:image" content="https://rxjs-dev.firebaseapp.com/assets/images/guide/marble-diagram-anatomy.svg">
<meta property="og:updated_time" content="2021-12-21T03:23:36.093Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RxJS文档 阅读笔记">
<meta name="twitter:description" content="知识依赖 基本的js语法 基本的nodejs用法 Promise用法  准备工作我想用nodejs直接跑rxjs，然而它并不支持es6的import，尝试了--experimental-modules依然有报错 方案1 在线编辑器https://rxjs-dev.firebaseapp.com/guide/observable 在上面代码点击右上角的Edit in StackBlitx 方案2 n">
<meta name="twitter:image" content="https://rxjs-dev.firebaseapp.com/assets/images/guide/marble-diagram-anatomy.svg">

<link rel="canonical" href="https://cromarmot.github.io/Blog/19-06-27-rxjs/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>RxJS文档 阅读笔记 | Cro-Marmot's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/Blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Cro-Marmot's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/Blog/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/Blog/20-07-13-rsa/#contact" rel="section"><i class="fa fa-user fa-fw"></i>關於</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/Blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/Blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/Blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


  <a href="https://codeforces.com/profile/Cro-Marmot" class="codeforces-corner" title="Star me on Codeforces" aria-label="Star me on Codeforces" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L250,250 L250,0 Z"></path>
  <path d="M125,10 125,125 240,125" fill="currentColor" style="transform-origin: 125px 125px;" class="octo-arm"></path>
  <path d="M125,10 240,10 240,125 Z" fill="currentColor" class="octo-body"></path></svg></a>



    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://cromarmot.github.io/Blog/19-06-27-rxjs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/Blog/images/avatar.gif">
      <meta itemprop="name" content="Cro-Marmot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cro-Marmot's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RxJS文档 阅读笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">發表於</span>

              <time title="創建時間：2019-06-27 01:01:01" itemprop="dateCreated datePublished" datetime="2019-06-27T01:01:01+08:00">2019-06-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新於</span>
                <time title="修改時間：2021-12-21 11:23:36" itemprop="dateModified" datetime="2021-12-21T11:23:36+08:00">2021-12-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分類於</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Blog/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/Blog/categories/code/frontend/" itemprop="url" rel="index"><span itemprop="name">frontend</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/Blog/19-06-27-rxjs/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="19-06-27-rxjs/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="知识依赖"><a href="#知识依赖" class="headerlink" title="知识依赖"></a>知识依赖</h1><ol start="0">
<li>基本的js语法</li>
<li>基本的nodejs用法</li>
<li>Promise用法</li>
</ol>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>我想用nodejs直接跑rxjs，然而它并不支持es6的import，尝试了<code>--experimental-modules</code>依然有报错</p>
<h2 id="方案1-在线编辑器"><a href="#方案1-在线编辑器" class="headerlink" title="方案1 在线编辑器"></a>方案1 在线编辑器</h2><p><code>https://rxjs-dev.firebaseapp.com/guide/observable</code> 在上面代码点击右上角的<code>Edit in StackBlitx</code></p>
<h2 id="方案2-nodejs-rxjs-ES6"><a href="#方案2-nodejs-rxjs-ES6" class="headerlink" title="方案2 nodejs + rxjs + ES6"></a>方案2 nodejs + rxjs + ES6</h2><p><code>https://github.com/standard-things/esm</code></p>
<p>安装:<code>npm install esm rxjs</code></p>
<p>带上<code>esm</code>运行</p>
<p><code>node -r esm index.js</code></p>
<h2 id="方案3-webpack-rxjs-ES6"><a href="#方案3-webpack-rxjs-ES6" class="headerlink" title="方案3 webpack + rxjs + ES6"></a>方案3 webpack + rxjs + ES6</h2><p>创建文件夹 并初始化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir rxjsdemo &amp;&amp; <span class="built_in">cd</span> rxjsdemo</span><br><span class="line">npx webpack-cli init</span><br></pre></td></tr></table></figure>
<p>这样选择</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">? Will your application have multiple bundles? No</span><br><span class="line">? Which will be your application entry point? index</span><br><span class="line">? In which folder do you want to store your generated bundles? dist</span><br><span class="line">? Will you use one of the below JS solutions? ES6</span><br><span class="line">? Will you use one of the below CSS solutions? No</span><br></pre></td></tr></table></figure>
<p>然后运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev rxjs</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; interval &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = interval(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">const</span> subscription = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure>
<p>运行<code>npm start</code>在打开的网页查看<code>console</code>是否正常输出， 忽略红字，能输出如下即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">observerA: 1</span><br><span class="line">observerB: 1</span><br><span class="line">observerA: 2</span><br><span class="line">observerB: 2</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="是个啥"><a href="#是个啥" class="headerlink" title="是个啥"></a>是个啥</h1><p>众所周知<code>Promise</code></p>
<p><code>Observable</code>可以看作一个更高级的<code>Promise</code></p>
<ul>
<li>Observable 返回值的个数为非负整数个，而Promise返回的个数为0或1个</li>
</ul>
<p>它说 Observables 不像 事件emitters也不像多个值的Promise， [虽然在某些使用下像</p>
<p>Observables are like functions with zero arguments, but generalize those to allow multiple values.</p>
<p>来源<code>https://subscription.packtpub.com/book/application_development/9781787120426/1/01lvl1sec7/a-brief-history-of-reactivex-and-rxjava</code></p>
<p>据说是2010年 微软一个大佬写的 <code>.NET</code>的一个框架,然后现在除了RxJs，还有Rx.Java,Rx.C++等等多语言支持</p>
<h1 id="Observables"><a href="#Observables" class="headerlink" title="Observables"></a>Observables</h1><h2 id="基本使用和对比"><a href="#基本使用和对比" class="headerlink" title="基本使用和对比"></a>基本使用和对比</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">new</span> Observable(<span class="function"><span class="params">subscriber</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello'</span>);</span><br><span class="line">  subscriber.next(<span class="number">42</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">foo.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;);</span><br><span class="line">foo.subscribe(<span class="function"><span class="params">y</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(y);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Hello</span><br><span class="line">42</span><br><span class="line">Hello</span><br><span class="line">42</span><br></pre></td></tr></table></figure>
<ol>
<li>lazy计算</li>
<li>订阅 类似于调用函数，它们是分开的，不同的订阅的执行不共享(相对而言 事件emitters并不会根据 订阅者个数而决定事件个数)</li>
</ol>
<h2 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'before'</span>);</span><br><span class="line">foo.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'after'</span>);</span><br></pre></td></tr></table></figure>
<p>ok 它是同步的</p>
<p>其实Observable有能力 同步分发值，和异步分发值</p>
<h2 id="和函数区别，能return很多次值"><a href="#和函数区别，能return很多次值" class="headerlink" title="和函数区别，能return很多次值"></a>和函数区别，能return很多次值</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">new</span> Observable(<span class="function"><span class="params">subscriber</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello'</span>);</span><br><span class="line">  subscriber.next(<span class="number">42</span>);</span><br><span class="line">  subscriber.next(<span class="number">100</span>); <span class="comment">// "return" another value</span></span><br><span class="line">  subscriber.next(<span class="number">200</span>); <span class="comment">// "return" yet another</span></span><br><span class="line">  <span class="comment">// 异步返回</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next(<span class="number">300</span>); <span class="comment">// happens asynchronously</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'before'</span>);</span><br><span class="line">foo.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'after'</span>);</span><br></pre></td></tr></table></figure>
<p><code>func.call()</code> 同步给我一个返回值<br><code>observable.subscribe()</code> 异步或同步 给我任意数量的值</p>
<h2 id="拆解-Observable"><a href="#拆解-Observable" class="headerlink" title="拆解 Observable"></a>拆解 Observable</h2><h3 id="创建-Observables"><a href="#创建-Observables" class="headerlink" title="创建 Observables"></a>创建 Observables</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> Observable(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">subscriber</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> id = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next(<span class="string">'hi'</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上是一个每秒向订阅者 发送<code>hi</code> 的<code>Observable</code></p>
<p>更常见的创建方式，是用创建函数<code>of</code>,<code>from</code>,<code>interval</code></p>
<h3 id="订阅-Observables"><a href="#订阅-Observables" class="headerlink" title="订阅 Observables"></a>订阅 Observables</h3><p>observable.subscribe(x =&gt; console.log(x)); // 相当于call了observable的函数</p>
<h3 id="执行-Observable"><a href="#执行-Observable" class="headerlink" title="执行 Observable"></a>执行 Observable</h3><p>可以调用的方法</p>
<p>Next 通知: 发送 数值，字符串，结构体</p>
<p>Error 通知: 发送一个 JavaScript Error or exception.</p>
<p>Complete 通知: 不带值.</p>
<p>正则描述<code>next*(error|complete)?</code> , 任意多个next，但当error或complete 其中一个执行后，就没有其它的可以分发了。</p>
<p>然后 建议了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  subscriber.next(...)<span class="comment">// ...</span></span><br><span class="line">  subscriber.next(...)<span class="comment">// ...</span></span><br><span class="line">  subscriber.next(...)<span class="comment">// ...</span></span><br><span class="line">  subscriber.next(...)<span class="comment">// ...</span></span><br><span class="line">  subscriber.complete();</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">  subscriber.error(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Disposing-Observables"><a href="#Disposing-Observables" class="headerlink" title="Disposing Observables"></a>Disposing Observables</h3><p>订阅者的退订</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">from</span> &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">from</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>]);</span><br><span class="line"><span class="keyword">const</span> subscription = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br><span class="line"><span class="comment">// Later:</span></span><br><span class="line">subscription.unsubscribe();</span><br></pre></td></tr></table></figure>
<p>发布者的关闭</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> Observable(<span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">subscriber</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Keep track of the interval resource</span></span><br><span class="line">  <span class="keyword">const</span> intervalId = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next(<span class="string">'hi'</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Provide a way of canceling and disposing the interval resource</span></span><br><span class="line">  <span class="comment">// 提供关闭发布者的方法</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    clearInterval(intervalId);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h1><h2 id="piping"><a href="#piping" class="headerlink" title="piping"></a>piping</h2><p><code>op4()(op3()(op2()(op1()(obs))))</code> 可读性差改为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">obs.pipe(</span><br><span class="line">  op1(),</span><br><span class="line">  op2(),</span><br><span class="line">  op3(),</span><br><span class="line">  op4(),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>按照这种格式，即使只有一层 也不应该用<code>op()(obs)</code>而是<code>obs.pipe(op())</code></p>
<p>pipeable operators: 用<code>observableInstance.pipe(operator())</code>的语法，如<code>filter(...)</code>和<code>mergeMap(...)</code>它们不会改变原来的<code>Observable</code>实例，而是返回新的<code>Observable</code></p>
<h2 id="Creation-Operators"><a href="#Creation-Operators" class="headerlink" title="Creation Operators"></a>Creation Operators</h2><p>Creation Operators: 创建新的Observable,如of,interval</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">of</span> &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line">map(<span class="function"><span class="params">x</span> =&gt;</span> x * x)(<span class="keyword">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)).subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`value: <span class="subst">$&#123;v&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logs:</span></span><br><span class="line"><span class="comment">// value: 1 </span></span><br><span class="line"><span class="comment">// value: 4</span></span><br><span class="line"><span class="comment">// value: 9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">first()(<span class="keyword">of</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`value: <span class="subst">$&#123;v&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logs:</span></span><br><span class="line"><span class="comment">// value: 1</span></span><br></pre></td></tr></table></figure>
<h2 id="Higher-order-Observables-高阶Observables"><a href="#Higher-order-Observables-高阶Observables" class="headerlink" title="Higher-order Observables 高阶Observables"></a>Higher-order Observables 高阶Observables</h2><p>处理 Observables of Observables</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const fileObservable = urlObservable.pipe(</span><br><span class="line">   map(url =&gt; http.get(url)),</span><br><span class="line">   concatAll(),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol>
<li><code>concatAll()</code> subscribes to each “inner” Observable that comes out of the “outer” Observable, and copies all the emitted values until that Observable completes, and goes on to the next one. All of the values are in that way concatenated,顺序 调用每个Observable</li>
<li><code>mergeAll()</code> — subscribes to each inner Observable as it arrives, then emits each value as it arrives,并行 调用每个Observable，获得了就输出</li>
<li><code>switchAll()</code> — subscribes to the first inner Observable when it arrives, and emits each value as it arrives, but when the next inner Observable arrives, unsubscribes to the previous one, and subscribes to the new one. 每当接受到新的 Observable 会舍弃老的Observable，当一个Observable 返回值，会立即emit</li>
<li><code>exhaust()</code> — subscribes to the first inner Observable when it arrives, and emits each value as it arrives, discarding all newly arriving inner Observables until that first one completes, then waits for the next inner Observable. 当前Observable 没有结束时，会抛弃后来的所有Observable，结束以后，接受一个Observables</li>
</ol>
<p>可以看到 <code>1</code>,<code>3</code>,<code>4</code>一个时刻 只有一个Observable在运行，1是串行办法，3是很可能半途而废 尽可能新，4是做就做完不被打断</p>
<p>就像很多 和<code>map</code>融合的方法这也有对应的,<code>concatMap()</code>, <code>mergeMap()</code>, <code>switchMap()</code>, and <code>exhaustMap()</code></p>
<h2 id="Marble-diagrams"><a href="#Marble-diagrams" class="headerlink" title="Marble diagrams"></a>Marble diagrams</h2><p><img src="https://rxjs-dev.firebaseapp.com/assets/images/guide/marble-diagram-anatomy.svg" alt="marble diagrams"></p>
<ol start="0">
<li>圆是值</li>
<li>上面的箭头是输入</li>
<li>下面的是输出</li>
<li>竖着的线是 完成态</li>
<li>叉是 抛出错误</li>
<li>正中是描述</li>
</ol>
<h2 id="所有Observables"><a href="#所有Observables" class="headerlink" title="所有Observables"></a>所有Observables</h2><p>按分类的: <code>https://rxjs-dev.firebaseapp.com/guide/operators</code></p>
<h2 id="自定义Observables"><a href="#自定义Observables" class="headerlink" title="自定义Observables"></a>自定义Observables</h2><p>组合已有的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; pipe &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; filter, map &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">discardOddDoubleEven</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> pipe(</span><br><span class="line">    filter(<span class="function"><span class="params">v</span> =&gt;</span> ! (v % <span class="number">2</span>)),</span><br><span class="line">    map(<span class="function"><span class="params">v</span> =&gt;</span> v + v),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这里的<code>pipe</code>和<code>.pipe</code>是不同的</p>
<p>从零开始写一个Observable</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delay</span>(<span class="params">delayInMillis</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">observable</span>) =&gt;</span> <span class="keyword">new</span> Observable(<span class="function"><span class="params">observer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// this function will called each time this</span></span><br><span class="line">    <span class="comment">// Observable is subscribed to.</span></span><br><span class="line">    <span class="keyword">const</span> allTimerIDs = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line">    <span class="keyword">const</span> subscription = observable.subscribe(&#123;</span><br><span class="line">      next(value) &#123;</span><br><span class="line">        <span class="keyword">const</span> timerID = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          observer.next(value);</span><br><span class="line">          allTimerIDs.delete(timerID);</span><br><span class="line">        &#125;, delayInMillis);</span><br><span class="line">        allTimerIDs.add(timerID);</span><br><span class="line">      &#125;,</span><br><span class="line">      error(err) &#123;</span><br><span class="line">        observer.error(err);</span><br><span class="line">      &#125;,</span><br><span class="line">      complete() &#123;</span><br><span class="line">        observer.complete();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// the return value is the teardown function,</span></span><br><span class="line">    <span class="comment">// which will be invoked when the new</span></span><br><span class="line">    <span class="comment">// Observable is unsubscribed from.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      subscription.unsubscribe();</span><br><span class="line">      allTimerIDs.forEach(<span class="function"><span class="params">timerID</span> =&gt;</span> &#123;</span><br><span class="line">        clearTimeout(timerID);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>你需要实现3个Observer functions, <code>next()</code>,<code>error()</code>,<code>complete()</code></li>
<li>实现<code>teardown</code>函数(清理结束内部的方法等) ，返回该函数</li>
</ol>
<h1 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h1><p><code>父子关系 + unsubscribe()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; interval &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> observable1 = interval(<span class="number">400</span>);</span><br><span class="line"><span class="keyword">const</span> observable2 = interval(<span class="number">300</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> subscription = observable1.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'first: '</span> + x));</span><br><span class="line"><span class="keyword">const</span> childSubscription = observable2.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'second: '</span> + x));</span><br><span class="line"> </span><br><span class="line">subscription.add(childSubscription);</span><br><span class="line"> </span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Unsubscribes BOTH subscription and childSubscription</span></span><br><span class="line">  subscription.unsubscribe();</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h1><p>plain Observables 是一个<code>单向广播</code>的</p>
<p>Subject 是一种<code>多向广播</code>的Observable</p>
<p><code>A Subject is like an Observable, but can multicast to many Observers. Subjects are like EventEmitters: they maintain a registry of many listeners.</code></p>
<p>对于订阅者来说，它无法区别它订阅的是Subject还是plain Observable</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Subject, <span class="keyword">from</span> &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject&lt;number&gt;();</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">from</span>([<span class="number">9</span>, <span class="number">5</span>, <span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">observable.subscribe(subject); <span class="comment">// You can subscribe providing a Subject</span></span><br></pre></td></tr></table></figure>
<p>以上我们可以看到，Subject既可以看作 订阅者，也可以当作发送者</p>
<h2 id="Multicasted-Observables"><a href="#Multicasted-Observables" class="headerlink" title="Multicasted Observables"></a>Multicasted Observables</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">from</span>, Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; multicast &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = <span class="keyword">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 数据源</span></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"><span class="keyword">const</span> multicasted = source.pipe(multicast(subject)); <span class="comment">// multicast(subject)(source) 见上面pipe用法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// These are, under the hood, `subject.subscribe(&#123;...&#125;)`:</span></span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is, under the hood, `source.subscribe(subject)`:</span></span><br><span class="line">multicasted.connect();</span><br></pre></td></tr></table></figure>
<p><code>multicast</code>: Observers 订阅一个潜在的 Subject, Subject 订阅 <code>源Observable</code>. 返回一个ConnectableObservable, 可以看作一个简单的 有 <code>connect()</code>方法的 <code>Observable</code></p>
<p><code>connect()</code>方法在后台执行<code>source.subscribe(subject)</code>方法,返回一个<code>Subscription</code>,对返回的变量可以 unsubscribe来结束执行</p>
<p>考虑下面情景</p>
<ol>
<li>A 订阅了 multicasted Observable</li>
<li>multicasted Observable 开始 connected</li>
<li>next 值 0 分发给A</li>
<li>B 订阅了 multicasted Observable</li>
<li>next 值 1 分发给A</li>
<li>next 值 1 分发给B</li>
<li>A 取消订阅</li>
<li>next 值 2 分发给B</li>
<li>B 取消订阅</li>
<li>multicasted Observable 的 connection  被 unsubscribed</li>
</ol>
<p>可以如下实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; interval, Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; multicast &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> source = interval(<span class="number">500</span>);</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"><span class="keyword">const</span> multicasted = source.pipe(multicast(subject));</span><br><span class="line"><span class="keyword">let</span> subscription1, subscription2, subscriptionConnect;</span><br><span class="line"> </span><br><span class="line">subscription1 = multicasted.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// We should call `connect()` here, because the first</span></span><br><span class="line"><span class="comment">// subscriber to `multicasted` is interested in consuming values</span></span><br><span class="line">subscriptionConnect = multicasted.connect();</span><br><span class="line"> </span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription2 = multicasted.subscribe(&#123;</span><br><span class="line">    next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">600</span>);</span><br><span class="line"> </span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription1.unsubscribe();</span><br><span class="line">&#125;, <span class="number">1200</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// We should unsubscribe the shared Observable execution here,</span></span><br><span class="line"><span class="comment">// because `multicasted` would have no more subscribers after this</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription2.unsubscribe();</span><br><span class="line">  subscriptionConnect.unsubscribe(); <span class="comment">// for the shared Observable execution</span></span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<p>手动调用<code>connect</code>有时很笨重,通常我们希望在第一个<code>Observer</code>到达时调用，在最后一个<code>Observer</code> unsubscribes 时, <code>refCount</code> 让 <code>multicasted Observable</code> 第一个<code>subscriber</code>到达时自动执行，在最后一个<code>subscriber</code>结束时自动 结束执行.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; interval, Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; multicast, refCount &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> source = interval(<span class="number">500</span>);</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"><span class="keyword">const</span> refCounted = source.pipe(multicast(subject), refCount());</span><br><span class="line"><span class="keyword">let</span> subscription1, subscription2;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// This calls `connect()`, because</span></span><br><span class="line"><span class="comment">// it is the first subscriber to `refCounted`</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'observerA subscribed'</span>);</span><br><span class="line">subscription1 = refCounted.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'observerB subscribed'</span>);</span><br><span class="line">  subscription2 = refCounted.subscribe(&#123;</span><br><span class="line">    next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">600</span>);</span><br><span class="line"> </span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'observerA unsubscribed'</span>);</span><br><span class="line">  subscription1.unsubscribe();</span><br><span class="line">&#125;, <span class="number">1200</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// This is when the shared Observable execution will stop, because</span></span><br><span class="line"><span class="comment">// `refCounted` would have no more subscribers after this</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'observerB unsubscribed'</span>);</span><br><span class="line">  subscription2.unsubscribe();</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<p>注意 只有<code>ConnectableObservable</code>上面有<code>refCount()</code>方法</p>
<h2 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h2><p><code>当前的值</code></p>
<p>它存储最后 给它consumers的值，当有新的订阅，则立即发送给它的订阅者</p>
<p>demo:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BehaviorSubject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> BehaviorSubject(<span class="number">0</span>); <span class="comment">// 0 is the initial value</span></span><br><span class="line"> </span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">subject.next(<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<h2 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h2><p>和BehaviorSubject类似，但是不是记录最后一个，而是buffer大小来决定记录最后的多少个，初始化传入buffer的大小</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ReplaySubject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> ReplaySubject(<span class="number">3</span>); <span class="comment">// buffer 3 values for new subscribers</span></span><br><span class="line"> </span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>); <span class="comment">// 上面 buffer大小设置为3，所以 observerB 只能接收到 [2,3,4]</span></span><br><span class="line">subject.next(<span class="number">3</span>);</span><br><span class="line">subject.next(<span class="number">4</span>);</span><br><span class="line"> </span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">subject.next(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p>除了可以指定buffer的size，也可以指定buffer的过期时间 <code>new ReplaySubject(buffer size, buffer time)</code>,单位毫秒</p>
<h2 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h2><p>只有在<code>complete</code>时才向它的订阅者发送最后一个 值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; AsyncSubject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> AsyncSubject();</span><br><span class="line"> </span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line">subject.next(<span class="number">3</span>);</span><br><span class="line">subject.next(<span class="number">4</span>);</span><br><span class="line"> </span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">subject.next(<span class="number">5</span>);</span><br><span class="line">subject.complete();</span><br></pre></td></tr></table></figure>
<p>只会接受到5</p>
<h1 id="Scheduler"><a href="#Scheduler" class="headerlink" title="Scheduler"></a>Scheduler</h1><p>调度！</p>
<p>关于<code>Promise</code>能有的和调度沾边的 只有<code>Promise.all()</code>,和<code>Promise.race()</code></p>
<ol>
<li>它是个数据结构，储存，基于 优先级或其它表转 执行队列任务</li>
<li>是一个执行环境,它表示 一个任务在何时何地被执行， 立即 或 回调</li>
<li>它有一个虚拟时钟， 通过调度器的<code>now()</code>方法，会回一个时间 标识，task得到的时间标识仅与其所在的调度器有关。</li>
</ol>
<p>A Scheduler lets you define in what execution context will an Observable deliver notifications to its Observer.</p>
<p>调度器，让你定义 在什么执行上下文下，一个Observale会向它的Observer分发同志</p>
<p>串行 <code>emit 1 2 3</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable, asyncScheduler &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observeOn &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> observable = <span class="keyword">new</span> Observable(<span class="function">(<span class="params">proxyObserver</span>) =&gt;</span> &#123;</span><br><span class="line">  proxyObserver.next(<span class="number">1</span>);</span><br><span class="line">  proxyObserver.next(<span class="number">2</span>);</span><br><span class="line">  proxyObserver.next(<span class="number">3</span>);</span><br><span class="line">  proxyObserver.complete();</span><br><span class="line">&#125;).pipe(</span><br><span class="line">  observeOn(asyncScheduler)</span><br><span class="line">);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> finalObserver = &#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'got value '</span> + x)</span><br><span class="line">  &#125;,</span><br><span class="line">  error(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'something wrong occurred: '</span> + err);</span><br><span class="line">  &#125;,</span><br><span class="line">  complete() &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'done'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'just before subscribe'</span>);</span><br><span class="line">observable.subscribe(finalObserver);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'just after subscribe'</span>);</span><br></pre></td></tr></table></figure>
<p><code>proxyObserver</code> 是 <code>observeOn(asyncScheduler)</code>创建出的，其中<code>next(val)</code>函数大约是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxyObserver = &#123;</span><br><span class="line">  next(val) &#123;</span><br><span class="line">    asyncScheduler.schedule(</span><br><span class="line">      (x) =&gt; finalObserver.next(x),</span><br><span class="line">      <span class="number">0</span> <span class="comment">/* delay */</span>, <span class="comment">// 仅管 这里设置为0, async 依然用的是setTimeout 或 setInterval来进行操作</span></span><br><span class="line">      val <span class="comment">/* will be the x for the function above */</span></span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除了<code>asyncScheduler</code>还有<code>queueScheduler</code>（遍历 当前事件frame）,<code>asapScheduler</code>（微任务队列调度，promise有用，在当前任务后，在下一个任务前用于异步交流）,<code>animationFrameScheduler</code>(在下一个 浏览器内容绘制前，可用于创建流畅的浏览器动画)</p>
<p>然后 你其实已经使用了调度器，只是隐式的</p>
<p>如，你在创建少量有限返回值的Observale时 用的是null或undefined调度器</p>
<p>对于返回大量或无限数据的用的是queue调度器</p>
<p>对于用到了timer的 用的是async调度器</p>
<p>对于一些性能优化的目的，你可以指定具体的调度器，如 <code>creation operator</code>的<code>from([10,20,30],asyncScheduler)</code></p>
<p>以下这些都支持传递 调度器 参数</p>
<ul>
<li>bindCallback</li>
<li>bindNodeCallback</li>
<li>combineLatest</li>
<li>concat</li>
<li>empty</li>
<li>from</li>
<li>fromPromise</li>
<li>interval</li>
<li>merge</li>
<li>of</li>
<li>range</li>
<li>throw</li>
<li>timer</li>
</ul>
<p>subscribeOn 可以把 上面 第二个参数传递调度器，改成， <code>obs.pipe(subscribeOn(调度器))</code>的写法</p>
<p><a href="https://rxjs-dev.firebaseapp.com/api/operators/subscribeOn" target="_blank" rel="noopener">https://rxjs-dev.firebaseapp.com/api/operators/subscribeOn</a></p>
<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><p>输入事件 每100ms的限制 来进行搜索</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Observable.fromEvent(input, <span class="string">'input'</span>)</span><br><span class="line">  .map(<span class="function"><span class="params">e</span> =&gt;</span> e.target.value)</span><br><span class="line">  .filter(<span class="function"><span class="params">value</span> =&gt;</span> value.length &gt;= <span class="number">1</span>)</span><br><span class="line">  .throttleTime(<span class="number">100</span>) <span class="comment">// https://rxjs-dev.firebaseapp.com/api/operators/throttleTime</span></span><br><span class="line">  .distinctUntilChanged() <span class="comment">// https://rxjs-dev.firebaseapp.com/api/operators/distinctUntilChanged</span></span><br><span class="line">  .switchMap(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="string">"message is "</span> + value) <span class="comment">// 或者替换为搜索 函数</span></span><br><span class="line">  .subscribe(</span><br><span class="line">    x =&gt; renderSearchResult(x), <span class="comment">// 渲染搜索结果</span></span><br><span class="line">    err =&gt; <span class="built_in">console</span>.error(err)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>同时调用 多个 异步方法，等待3个全回调</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable, pipe &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; skip, take &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchdata</span>(<span class="params">url,cb</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'start fetch'</span>+url);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fetched'</span>+url);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ob = Observable.create(<span class="function">(<span class="params">observer</span>)=&gt;</span>&#123;</span><br><span class="line">  fetchdata(<span class="string">'/url1'</span>,()=&gt;&#123;</span><br><span class="line">    observer.next();</span><br><span class="line">  &#125;);</span><br><span class="line">  fetchdata(<span class="string">'/url2'</span>,()=&gt;&#123;</span><br><span class="line">    observer.next();</span><br><span class="line">  &#125;);</span><br><span class="line">  fetchdata(<span class="string">'/url3'</span>,()=&gt;&#123;</span><br><span class="line">    observer.next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;).pipe(skip(<span class="number">2</span>),take(<span class="number">1</span>)).subscribe(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'finish'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="生命周期实例"><a href="#生命周期实例" class="headerlink" title="生命周期实例"></a>生命周期实例</h1><p>需求: angular 内页面上有一些observables。</p>
<p>我们希望在页面销毁时 能结束这些。（否则会有内存泄漏）</p>
<h2 id="方案1-手动逐个unsubscrible"><a href="#方案1-手动逐个unsubscrible" class="headerlink" title="方案1 手动逐个unsubscrible"></a>方案1 手动逐个unsubscrible</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;...&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit, OnDestroy &#123;</span><br><span class="line">    subscription1$: Subscription</span><br><span class="line">    subscription2$: Subscription </span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">var</span> observable1$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">var</span> observable2$ = Rx.Observable.interval(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">this</span>.subscription1$ = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"From interval 1000"</span> x));</span><br><span class="line">        <span class="keyword">this</span>.subscription2$ = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"From interval 400"</span> x));</span><br><span class="line">    &#125;</span><br><span class="line">    ngOnDestroy() &#123;</span><br><span class="line">        <span class="keyword">this</span>.subscription1$.unsubscribe()</span><br><span class="line">        <span class="keyword">this</span>.subscription2$.unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方案2-用数组，循环unsubscrible"><a href="#方案2-用数组，循环unsubscrible" class="headerlink" title="方案2 用数组，循环unsubscrible"></a>方案2 用数组，循环unsubscrible</h2><p>优点，新增时，只需要 新增和添加到数组，不需要修改OnDestroy的代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;...&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit, OnDestroy &#123;</span><br><span class="line">    subscription1$: Subscription </span><br><span class="line">    subscription2$: Subscription </span><br><span class="line">    subscriptions: Subscription[] = []</span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">var</span> observable1$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">var</span> observable2$ = Rx.Observable.interval(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">this</span>.subscription1$ = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"From interval 1000"</span> x));</span><br><span class="line">        <span class="keyword">this</span>.subscription2$ = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"From interval 400"</span> x));</span><br><span class="line">        <span class="keyword">this</span>.subscriptions.push(<span class="keyword">this</span>.subscription1$)</span><br><span class="line">        <span class="keyword">this</span>.subscriptions.push(<span class="keyword">this</span>.subscription2$)</span><br><span class="line">    &#125;</span><br><span class="line">    ngOnDestroy() &#123;</span><br><span class="line">        <span class="keyword">this</span>.subscriptions.forEach(<span class="function">(<span class="params">subscription</span>) =&gt;</span> subscription.unsubscribe())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方案3-用Subscription"><a href="#方案3-用Subscription" class="headerlink" title="方案3 用Subscription"></a>方案3 用Subscription</h2><p>优点，用自带的Subscription 替代手工数组(对写法影响不大。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;...&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit, OnDestroy &#123;</span><br><span class="line">    </span><br><span class="line">    subscription: Subscription</span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">var</span> observable1$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">var</span> observable2$ = Rx.Observable.interval(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">var</span> subscription1$ = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"From interval 1000"</span> x));</span><br><span class="line">        <span class="keyword">var</span> subscription2$ = observable.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"From interval 400"</span> x));</span><br><span class="line">        <span class="keyword">this</span>.subscription.add(subscription1$)</span><br><span class="line">        <span class="keyword">this</span>.subscription.add(subscription2$)</span><br><span class="line">    &#125;</span><br><span class="line">    ngOnDestroy() &#123;</span><br><span class="line">        <span class="keyword">this</span>.subscription.unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方案4-async-pipe"><a href="#方案4-async-pipe" class="headerlink" title="方案4 async pipe"></a>方案4 async pipe</h2><p>对于直接的observable，直接上async，不需要手动unsubscribe，依赖angular内部自动unsubscribe。</p>
<p>缺点，对于复杂的并不适用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    ...,</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div&gt;</span></span><br><span class="line"><span class="string">         Interval: &#123;&#123;observable$ | async&#125;&#125;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line">    observable$</span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">this</span>.observable$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方案5-take"><a href="#方案5-take" class="headerlink" title="方案5 take"></a>方案5 take</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">take(n)</span><br><span class="line">takeUntil(notifier)</span><br><span class="line">takeWhile(predicate)</span><br></pre></td></tr></table></figure>
<p>take依然需要unsubscribe</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit, OnDestroy &#123;</span><br><span class="line">    subscription$</span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">var</span> observable$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">this</span>.subscription$ = observable$.pipe(take(<span class="number">1</span>)).</span><br><span class="line">        subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x))</span><br><span class="line">    &#125;</span><br><span class="line">    ngOnDestroy() &#123;</span><br><span class="line">        <span class="keyword">this</span>.subscription$.unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>takeUntil目前感觉是最好的，3行完成初始化和关闭，在需要的部分用pipe接上即可。易于代码插拔</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;...&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit, OnDestroy &#123;</span><br><span class="line">    notifier = <span class="keyword">new</span> Subject()</span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">var</span> observable$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">        observable$.pipe(takeUntil(<span class="keyword">this</span>.notifier))</span><br><span class="line">        .subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br><span class="line">    &#125;</span><br><span class="line">    ngOnDestroy() &#123;</span><br><span class="line">        <span class="keyword">this</span>.notifier.next()</span><br><span class="line">        <span class="keyword">this</span>.notifier.complete()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>takeWhile依然需要unsubscrible</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;...&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit, OnDestroy &#123;</span><br><span class="line">    subscription$</span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">var</span> observable$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">this</span>.subscription$ = observable$.pipe(takeWhile(<span class="function"><span class="params">value</span> =&gt;</span> value &lt; <span class="number">10</span>))</span><br><span class="line">        .subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br><span class="line">    &#125;</span><br><span class="line">    ngOnDestroy() &#123;</span><br><span class="line">        <span class="keyword">this</span>.subscription$.unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方案6-first"><a href="#方案6-first" class="headerlink" title="方案6 first"></a>方案6 first</h2><p>不确定页面是否先destroy, 还是建议在ngOnDestroy 里显示取消</p>
<h2 id="方案7-利用注解-自动取消"><a href="#方案7-利用注解-自动取消" class="headerlink" title="方案7 利用注解 自动取消"></a>方案7 利用注解 自动取消</h2><p><a href="https://www.typescriptlang.org/docs/handbook/decorators.html" target="_blank" rel="noopener">typescript decorators</a></p>
<p>实现(和 参考的文章不同，我们调用apply会传入原始的this，并且让用户的apply先于 unsubscribe, 关注所有的unsubscribe)</p>
<p>缺点是，所有的 需要一个放在this上的变量，才能被自动取消订阅</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AutoUnsub = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">constructor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> orig = <span class="keyword">constructor</span>.prototype.ngOnDestroy;</span><br><span class="line">    <span class="keyword">constructor</span>.prototype.ngOnDestroy = function(<span class="params"></span>): void &#123;</span><br><span class="line">      orig.apply(<span class="keyword">this</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> element of <span class="built_in">Object</span>.values(<span class="keyword">this</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((element <span class="keyword">as</span> Unsubscribable) &amp;&amp; (element <span class="keyword">as</span> Unsubscribable).unsubscribe) &#123;</span><br><span class="line">          (element <span class="keyword">as</span> Unsubscribable).unsubscribe();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br><span class="line"><span class="meta">@AutoUnsub</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line">    observable$</span><br><span class="line">    ngOnInit () &#123;</span><br><span class="line">        <span class="keyword">this</span>.observable$ = Rx.Observable.interval(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">this</span>.observable$.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作者有提到tslint来检查是否有Destroy，但看起来并不够优雅了。</p>
<p>综上，感觉最科学的是takeUntil</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://stackoverflow.com/questions/45854169/how-can-i-use-an-es6-import-in-node" target="_blank" rel="noopener">stackoverflow: es6 + node</a></p>
<p><a href="https://github.com/webpack/webpack-cli/blob/master/packages/init/README.md#webpack-cli-init" target="_blank" rel="noopener">webpack-cli init</a></p>
<p><a href="https://github.com/standard-things/esm" target="_blank" rel="noopener">esm</a></p>
<p><a href="https://rxjs-dev.firebaseapp.com/guide/observable" target="_blank" rel="noopener">observable</a></p>
<p><a href="https://angular.io/guide/observables" target="_blank" rel="noopener">angular.io:observables</a></p>
<p><a href="https://rxmarbles.com/" target="_blank" rel="noopener">rxmarbles 宝石图</a></p>
<p><a href="https://cn.rx.js.org/class/es6/Observable.js~Observable.html" target="_blank" rel="noopener">cn.rx.js.org</a></p>
<p><a href="https://webpack.js.org/guides/typescript/" target="_blank" rel="noopener">webpack + typescript</a></p>
<p><a href="https://en.wikipedia.org/wiki/Reactive_extensions" target="_blank" rel="noopener">wikipedia ReactiveX</a></p>
<p><a href="https://blog.bitsrc.io/6-ways-to-unsubscribe-from-observables-in-angular-ab912819a78f" target="_blank" rel="noopener">unsubscribe from observables</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/Blog/tags/Angular2/" rel="tag"># Angular2+</a>
              <a href="/Blog/tags/rxjs/" rel="tag"># rxjs</a>
              <a href="/Blog/tags/observable/" rel="tag"># observable</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Blog/19-06-17-webpack/" rel="prev" title="webpack文档 阅读笔记">
      <i class="fa fa-chevron-left"></i> webpack文档 阅读笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/Blog/19-07-08-gitlabserver/" rel="next" title="gitlab server 搭建">
      gitlab server 搭建 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#知识依赖"><span class="nav-number">1.</span> <span class="nav-text">知识依赖</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#准备工作"><span class="nav-number">2.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#方案1-在线编辑器"><span class="nav-number">2.1.</span> <span class="nav-text">方案1 在线编辑器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案2-nodejs-rxjs-ES6"><span class="nav-number">2.2.</span> <span class="nav-text">方案2 nodejs + rxjs + ES6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案3-webpack-rxjs-ES6"><span class="nav-number">2.3.</span> <span class="nav-text">方案3 webpack + rxjs + ES6</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#是个啥"><span class="nav-number">3.</span> <span class="nav-text">是个啥</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Observables"><span class="nav-number">4.</span> <span class="nav-text">Observables</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本使用和对比"><span class="nav-number">4.1.</span> <span class="nav-text">基本使用和对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#同步"><span class="nav-number">4.2.</span> <span class="nav-text">同步</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#和函数区别，能return很多次值"><span class="nav-number">4.3.</span> <span class="nav-text">和函数区别，能return很多次值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拆解-Observable"><span class="nav-number">4.4.</span> <span class="nav-text">拆解 Observable</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-Observables"><span class="nav-number">4.4.1.</span> <span class="nav-text">创建 Observables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#订阅-Observables"><span class="nav-number">4.4.2.</span> <span class="nav-text">订阅 Observables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行-Observable"><span class="nav-number">4.4.3.</span> <span class="nav-text">执行 Observable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Disposing-Observables"><span class="nav-number">4.4.4.</span> <span class="nav-text">Disposing Observables</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Operators"><span class="nav-number">5.</span> <span class="nav-text">Operators</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#piping"><span class="nav-number">5.1.</span> <span class="nav-text">piping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Creation-Operators"><span class="nav-number">5.2.</span> <span class="nav-text">Creation Operators</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Higher-order-Observables-高阶Observables"><span class="nav-number">5.3.</span> <span class="nav-text">Higher-order Observables 高阶Observables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Marble-diagrams"><span class="nav-number">5.4.</span> <span class="nav-text">Marble diagrams</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#所有Observables"><span class="nav-number">5.5.</span> <span class="nav-text">所有Observables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义Observables"><span class="nav-number">5.6.</span> <span class="nav-text">自定义Observables</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Subscription"><span class="nav-number">6.</span> <span class="nav-text">Subscription</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Subject"><span class="nav-number">7.</span> <span class="nav-text">Subject</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Multicasted-Observables"><span class="nav-number">7.1.</span> <span class="nav-text">Multicasted Observables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BehaviorSubject"><span class="nav-number">7.2.</span> <span class="nav-text">BehaviorSubject</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReplaySubject"><span class="nav-number">7.3.</span> <span class="nav-text">ReplaySubject</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AsyncSubject"><span class="nav-number">7.4.</span> <span class="nav-text">AsyncSubject</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Scheduler"><span class="nav-number">8.</span> <span class="nav-text">Scheduler</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实例"><span class="nav-number">9.</span> <span class="nav-text">实例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#生命周期实例"><span class="nav-number">10.</span> <span class="nav-text">生命周期实例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#方案1-手动逐个unsubscrible"><span class="nav-number">10.1.</span> <span class="nav-text">方案1 手动逐个unsubscrible</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案2-用数组，循环unsubscrible"><span class="nav-number">10.2.</span> <span class="nav-text">方案2 用数组，循环unsubscrible</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案3-用Subscription"><span class="nav-number">10.3.</span> <span class="nav-text">方案3 用Subscription</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案4-async-pipe"><span class="nav-number">10.4.</span> <span class="nav-text">方案4 async pipe</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案5-take"><span class="nav-number">10.5.</span> <span class="nav-text">方案5 take</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案6-first"><span class="nav-number">10.6.</span> <span class="nav-text">方案6 first</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#方案7-利用注解-自动取消"><span class="nav-number">10.7.</span> <span class="nav-text">方案7 利用注解 自动取消</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">11.</span> <span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Cro-Marmot</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/Blog/archives/">
        
          <span class="site-state-item-count">111</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/Blog/categories/">
          
        <span class="site-state-item-count">52</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/Blog/tags/">
          
        <span class="site-state-item-count">126</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CroMarmot" title="GitHub → https://github.com/CroMarmot" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yexiaorain@gmail.com" title="E-Mail → mailto:yexiaorain@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codeforces.com/profile/Cro-Marmot" title="Codeforces → https://codeforces.com/profile/Cro-Marmot" rel="noopener" target="_blank"><i class="bug fa-fw"></i>Codeforces</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://atcoder.jp/users/cromarmot" title="AtCoder → https://atcoder.jp/users/cromarmot" rel="noopener" target="_blank"><i class="bug fa-fw"></i>AtCoder</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cro-Marmot</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 強力驅動
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/Blog/lib/anime.min.js"></script>
  <script src="/Blog/lib/velocity/velocity.min.js"></script>
  <script src="/Blog/lib/velocity/velocity.ui.min.js"></script>
<script src="/Blog/js/utils.js"></script><script src="/Blog/js/motion.js"></script>
<script src="/Blog/js/schemes/muse.js"></script>
<script src="/Blog/js/next-boot.js"></script>



  




  <script src="/Blog/js/local-search.js"></script>












  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://cromarmot.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://cromarmot.github.io/Blog/19-06-27-rxjs/";
    this.page.identifier = "19-06-27-rxjs/";
    this.page.title = "RxJS文档 阅读笔记";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://cromarmot.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
